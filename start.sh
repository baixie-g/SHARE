#!/bin/bash

# g00jå°ç«™ æ–‡ä»¶å…±äº«ç³»ç»Ÿ - å¯åŠ¨è„šæœ¬

echo "=== g00jå°ç«™å¯åŠ¨è„šæœ¬ ==="

# æ£€æŸ¥å¯æ‰§è¡Œæ–‡ä»¶æ˜¯å¦å­˜åœ¨
if [ ! -f "bin/g00j_file_share" ]; then
    echo "é”™è¯¯: æœªæ‰¾åˆ°å¯æ‰§è¡Œæ–‡ä»¶ bin/g00j_file_share"
    echo "è¯·å…ˆè¿è¡Œ ./build.sh æž„å»ºé¡¹ç›®"
    exit 1
fi

# æ£€æŸ¥å¹¶åˆ›å»ºå¿…è¦çš„ç›®å½•
echo "æ£€æŸ¥ç›®å½•ç»“æž„..."
mkdir -p bin
mkdir -p shared/videos
mkdir -p shared/documents
mkdir -p shared/images
mkdir -p shared/others
mkdir -p static

# åˆ›å»ºé»˜è®¤çš„æ¬¢è¿Žæ–‡æ¡£
if [ ! -f "shared/documents/welcome.txt" ]; then
    echo "åˆ›å»ºé»˜è®¤æ¬¢è¿Žæ–‡æ¡£..."
    cat > shared/documents/welcome.txt << EOF
æ¬¢è¿Žä½¿ç”¨ g00jå°ç«™ æ–‡ä»¶å…±äº«ç³»ç»Ÿï¼

è¿™æ˜¯ä¸€ä¸ªåŸºäºŽC++å’ŒVue3å¼€å‘çš„è½»é‡çº§æ–‡ä»¶å…±äº«å¹³å°ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š

## åŠŸèƒ½ç‰¹æ€§
- ðŸ” ç”¨æˆ·æƒé™ç®¡ç†ï¼ˆæ¸¸å®¢ã€æ³¨å†Œç”¨æˆ·ã€ç®¡ç†å‘˜ï¼‰
- ðŸ“ æ–‡ä»¶ä¸Šä¼ ã€ä¸‹è½½ã€åœ¨çº¿é¢„è§ˆ
- ðŸŽ¥ è§†é¢‘åœ¨çº¿æ’­æ”¾
- ðŸ“„ æ–‡æ¡£åœ¨çº¿é˜…è¯»
- ðŸ–¼ï¸ å›¾ç‰‡é¢„è§ˆ
- ðŸ“Š ç³»ç»Ÿèµ„æºç›‘æŽ§
- ðŸ” æ–‡ä»¶æœç´¢åŠŸèƒ½

## é»˜è®¤è´¦æˆ·
- ç®¡ç†å‘˜: admin / admin123
- æ™®é€šç”¨æˆ·: éœ€è¦æ³¨å†Œ

## è®¿é—®åœ°å€
- ä¸»é¡µ: http://localhost:8080
- ç®¡ç†é¢æ¿: ç™»å½•åŽå¯è§

ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼
EOF
fi

# åˆ›å»ºAPIæ–‡æ¡£
if [ ! -f "shared/documents/README_API.md" ]; then
    echo "åˆ›å»ºAPIæ–‡æ¡£..."
    cat > shared/documents/README_API.md << EOF
# g00jå°ç«™ API æ–‡æ¡£

## ç”¨æˆ·è®¤è¯

### ç”¨æˆ·ç™»å½•
- **POST** /api/login
- **è¯·æ±‚ä½“**: {"username": "ç”¨æˆ·å", "password": "å¯†ç "}
- **å“åº”**: ç”¨æˆ·ä¿¡æ¯å’Œä¼šè¯Cookie

### ç”¨æˆ·æ³¨å†Œ
- **POST** /api/register
- **è¯·æ±‚ä½“**: {"username": "ç”¨æˆ·å", "password": "å¯†ç "}
- **å“åº”**: æ³¨å†Œç»“æžœ

### ç”¨æˆ·ç™»å‡º
- **POST** /api/logout
- **å“åº”**: ç™»å‡ºç»“æžœï¼Œæ¸…é™¤ä¼šè¯

## æ–‡ä»¶ç®¡ç†

### èŽ·å–æ–‡ä»¶åˆ—è¡¨
- **GET** /api/files
- **å‚æ•°**: 
  - limit: æ¯é¡µæ•°é‡ (é»˜è®¤50)
  - offset: åç§»é‡ (é»˜è®¤0)
  - category: æ–‡ä»¶åˆ†ç±» (å¯é€‰)
- **å“åº”**: æ–‡ä»¶åˆ—è¡¨

### æ–‡ä»¶ä¸Šä¼ 
- **POST** /api/upload
- **è¯·æ±‚ä½“**: multipart/form-data
- **å“åº”**: ä¸Šä¼ ç»“æžœ

### æ–‡ä»¶ä¸‹è½½
- **GET** /api/download/[æ–‡ä»¶ID]
- **å“åº”**: æ–‡ä»¶å†…å®¹

## ç³»ç»Ÿç›‘æŽ§

### èŽ·å–ç³»ç»ŸçŠ¶æ€
- **GET** /api/system/status
- **å“åº”**: CPUã€å†…å­˜ã€ç£ç›˜ä½¿ç”¨æƒ…å†µ

### èŽ·å–è¿›ç¨‹åˆ—è¡¨
- **GET** /api/system/processes
- **å“åº”**: ç³»ç»Ÿè¿›ç¨‹åˆ—è¡¨ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰

## é”™è¯¯ä»£ç 

- 200: æˆåŠŸ
- 400: è¯·æ±‚æ ¼å¼é”™è¯¯
- 401: æœªæŽˆæƒ
- 403: æƒé™ä¸è¶³
- 404: èµ„æºä¸å­˜åœ¨
- 409: èµ„æºå†²çª
- 500: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯
EOF
fi

echo "æ­£åœ¨å¯åŠ¨æœåŠ¡å™¨..."
echo "å¦‚éœ€åœæ­¢æœåŠ¡å™¨ï¼Œè¯·æŒ‰ Ctrl+C"
echo ""

# å¯åŠ¨æœåŠ¡å™¨
cd bin
./g00j_file_share 