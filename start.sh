#!/bin/bash

# g00jå°ç«™ å¯åŠ¨è„šæœ¬

echo "=== g00jå°ç«™ æ–‡ä»¶å…±äº«ç³»ç»Ÿ ==="
echo "æ­£åœ¨å¯åŠ¨æœåŠ¡å™¨..."

# æ£€æŸ¥å¯æ‰§è¡Œæ–‡ä»¶æ˜¯å¦å­˜åœ¨
if [ ! -f "./build/bin/g00j_file_share" ]; then
    echo "é”™è¯¯: å¯æ‰§è¡Œæ–‡ä»¶ä¸å­˜åœ¨"
    echo "è¯·å…ˆè¿è¡Œæž„å»ºè„šæœ¬: ./build.sh"
    exit 1
fi

# åˆ›å»ºå¿…è¦çš„ç›®å½•
echo "æ­£åœ¨åˆå§‹åŒ–ç›®å½•ç»“æž„..."

# åˆ›å»ºå…±äº«æ–‡ä»¶ç›®å½•
mkdir -p shared/videos
mkdir -p shared/images  
mkdir -p shared/documents
mkdir -p shared/others

echo "âœ“ å…±äº«æ–‡ä»¶ç›®å½•å·²åˆ›å»º"

# åˆ›å»ºé»˜è®¤æ–‡æ¡£
if [ ! -f "shared/documents/README_API.md" ]; then
    cat > shared/documents/README_API.md << 'EOF'
# g00jå°ç«™ API æ–‡æ¡£

## ç®€ä»‹

g00jå°ç«™æ˜¯ä¸€ä¸ªè½»é‡çº§çš„æ–‡ä»¶å…±äº«ç³»ç»Ÿï¼Œæä¾›ä»¥ä¸‹ä¸»è¦åŠŸèƒ½ï¼š

- æ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½
- åœ¨çº¿æ–‡ä»¶é¢„è§ˆï¼ˆè§†é¢‘ã€å›¾ç‰‡ã€æ–‡æ¡£ï¼‰
- ç”¨æˆ·ç®¡ç†å’Œæƒé™æŽ§åˆ¶
- ç³»ç»Ÿç›‘æŽ§ï¼ˆç®¡ç†å‘˜æƒé™ï¼‰

## API æŽ¥å£

### ç”¨æˆ·è®¤è¯

#### ç™»å½•
- **POST** `/api/login`
- å‚æ•°: `username`, `password`
- è¿”å›ž: æˆåŠŸåŽè®¾ç½® session cookie

#### æ³¨å†Œ
- **POST** `/api/register`
- å‚æ•°: `username`, `password`
- è¿”å›ž: æ³¨å†Œç»“æžœ

#### ç™»å‡º
- **POST** `/api/logout`
- æ¸…é™¤ session cookie

### æ–‡ä»¶ç®¡ç†

#### èŽ·å–æ–‡ä»¶åˆ—è¡¨
- **GET** `/api/files`
- å‚æ•°: `page` (é¡µç ), `limit` (æ¯é¡µæ•°é‡), `category` (åˆ†ç±»)
- è¿”å›ž: æ–‡ä»¶åˆ—è¡¨å’Œåˆ†é¡µä¿¡æ¯

#### æ–‡ä»¶ä¸Šä¼ 
- **POST** `/api/upload`
- éœ€è¦ç™»å½•æƒé™
- æ”¯æŒå¤šæ–‡ä»¶ä¸Šä¼ 

### ç³»ç»Ÿç›‘æŽ§ (ç®¡ç†å‘˜æƒé™)

#### ç³»ç»ŸçŠ¶æ€
- **GET** `/api/system/status`
- è¿”å›ž: CPUã€å†…å­˜ã€ç£ç›˜ä½¿ç”¨çŽ‡ç­‰ä¿¡æ¯

#### è¿›ç¨‹åˆ—è¡¨
- **GET** `/api/system/processes`
- è¿”å›ž: ç³»ç»Ÿè¿›ç¨‹åˆ—è¡¨

## æ–‡ä»¶åˆ†ç±»

- **videos**: è§†é¢‘æ–‡ä»¶ (MP4, AVI, MKV, MOV, WMV, FLV)
- **images**: å›¾ç‰‡æ–‡ä»¶ (JPG, PNG, GIF, BMP, WEBP)
- **documents**: æ–‡æ¡£æ–‡ä»¶ (TXT, MD, PDF, DOC, DOCX, XLS, XLSX)
- **others**: å…¶ä»–ç±»åž‹æ–‡ä»¶

## é»˜è®¤ç”¨æˆ·

- **ç®¡ç†å‘˜**: admin / admin123
- **æ™®é€šç”¨æˆ·**: éœ€è¦æ³¨å†Œ

## æŠ€æœ¯ç‰¹æ€§

- C++17 åŽç«¯
- Vue3 å‰ç«¯
- SQLite3 æ•°æ®åº“
- OpenSSL å®‰å…¨åŠ å¯†
- å¤šçº¿ç¨‹å¤„ç†
- å“åº”å¼ UI è®¾è®¡

---

æ¬¢è¿Žä½¿ç”¨ g00jå°ç«™ï¼
EOF
    echo "âœ“ API æ–‡æ¡£å·²åˆ›å»º"
fi

if [ ! -f "shared/documents/welcome.txt" ]; then
    cat > shared/documents/welcome.txt << 'EOF'
æ¬¢è¿Žä½¿ç”¨ g00jå°ç«™ æ–‡ä»¶å…±äº«ç³»ç»Ÿï¼

è¿™æ˜¯ä¸€ä¸ªè½»é‡çº§çš„æ–‡ä»¶å…±äº«å¹³å°ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

ðŸŽ¬ è§†é¢‘æ’­æ”¾ - æ”¯æŒ MP4, AVI, MKV ç­‰å¤šç§æ ¼å¼åœ¨çº¿æ’­æ”¾
ðŸ“„ æ–‡æ¡£é˜…è¯» - æ”¯æŒ TXT, MD ç­‰æ–‡æœ¬æ–‡ä»¶åœ¨çº¿é˜…è¯»  
ðŸ–¼ï¸ å›¾ç‰‡é¢„è§ˆ - æ”¯æŒå¸¸è§å›¾ç‰‡æ ¼å¼å¿«é€Ÿé¢„è§ˆ
ðŸ“ æ–‡ä»¶ç®¡ç† - ä¸Šä¼ ã€ä¸‹è½½ã€åˆ†ç±»ç®¡ç†å¤šç§æ–‡ä»¶ç±»åž‹
ðŸ“Š ç³»ç»Ÿç›‘æŽ§ - å®žæ—¶ç›‘æŽ§ç³»ç»ŸçŠ¶æ€å’Œè¿›ç¨‹ä¿¡æ¯ï¼ˆç®¡ç†å‘˜åŠŸèƒ½ï¼‰

å®‰å…¨ç‰¹æ€§ï¼š
- ç”¨æˆ·è®¤è¯å’Œæƒé™ç®¡ç†
- æ–‡ä»¶ç±»åž‹å®‰å…¨éªŒè¯
- è·¯å¾„å®‰å…¨æ£€æŸ¥
- æ–‡ä»¶å¤§å°é™åˆ¶

ä½¿ç”¨è¯´æ˜Žï¼š
1. æ¸¸å®¢å¯ä»¥æŸ¥çœ‹å’Œé¢„è§ˆæ–‡ä»¶ï¼Œä¸‹è½½éœ€è¦ç™»å½•
2. æ³¨å†Œç”¨æˆ·å¯ä»¥ä¸Šä¼ å’Œç®¡ç†ä¸ªäººæ–‡ä»¶
3. ç®¡ç†å‘˜å…·æœ‰ç³»ç»Ÿç›‘æŽ§å’Œå…¨å±€ç®¡ç†æƒé™

é»˜è®¤ç®¡ç†å‘˜è´¦æˆ·ï¼šadmin / admin123

æŠ€æœ¯æ ˆï¼š
- åŽç«¯ï¼šC++17 + SQLite3 + OpenSSL
- å‰ç«¯ï¼šVue3 + Axios
- æž„å»ºï¼šCMake
- å¹³å°ï¼šLinux

äº«å—æ‚¨çš„æ–‡ä»¶å…±äº«ä½“éªŒï¼

--- g00jå°ç«™å¼€å‘å›¢é˜Ÿ
EOF
    echo "âœ“ æ¬¢è¿Žæ–‡æ¡£å·²åˆ›å»º"
fi

echo
echo "æ­£åœ¨å¯åŠ¨æœåŠ¡å™¨..."
echo "æœåŠ¡å™¨åœ°å€: http://localhost:8080"
echo "é»˜è®¤ç®¡ç†å‘˜: admin / admin123"
echo
echo "æŒ‰ Ctrl+C åœæ­¢æœåŠ¡å™¨"
echo

# å¯åŠ¨æœåŠ¡å™¨
./build/bin/g00j_file_share 