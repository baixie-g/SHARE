<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>112å°ç«™ - ç½‘ç›˜</title>
    <!-- ç½‘ç«™å›¾æ ‡ -->
    <link rel="icon" href="data:image/svg+xml,&lt;svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'&gt;&lt;rect x='1' y='1' width='14' height='14' rx='2' fill='%234A90E2'/&gt;&lt;path d='M4,5 L12,5 L12,6.5 L4,6.5 L4,5 Z M4,8 L12,8 L12,9.5 L4,9.5 L4,8 Z M4,11 L9,11 L9,12.5 L4,12.5 L4,11 Z' fill='white'/&gt;&lt;/svg&gt;">
    <link rel="stylesheet" href="/css/style.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>
<body>
    <div id="app">
        <!-- å¯¼èˆªæ  -->
        <nav class="navbar">
            <div class="nav-container">
                <div class="nav-brand">
                    <h1>ğŸ“¦ 112ç½‘ç›˜</h1>
                </div>
                <div class="nav-menu">
                    <button @click="currentView = 'home'" :class="{'active': currentView === 'home'}">
                        ğŸ  é¦–é¡µ
                    </button>
                    <button v-if="user" @click="currentView = 'myfiles'" :class="{'active': currentView === 'myfiles'}">
                        ğŸ“ æˆ‘çš„æ–‡ä»¶
                    </button>
                    <button @click="currentView = 'shared'" :class="{'active': currentView === 'shared'}">
                        ğŸŒ å…¬å…±åˆ†äº«
                    </button>
                    <button v-if="user && user.role === 'admin'" @click="currentView = 'monitor'" 
                            :class="{'active': currentView === 'monitor'}">
                        ğŸ“Š ç³»ç»Ÿç›‘æ§
                    </button>
                    <button v-if="user && user.role === 'admin'" @click="currentView = 'admin'" 
                            :class="{'active': currentView === 'admin'}">
                        âš™ï¸ ç®¡ç†é¢æ¿
                    </button>
                    <button v-if="!user" @click="showLoginModal = true" class="login-btn">
                        ğŸ”‘ ç™»å½•
                    </button>
                    <div v-if="user" class="user-menu">
                        <span>ğŸ‘¤ {{ user.username }}</span>
                        <button @click="logout" class="logout-btn">ğŸšª ç™»å‡º</button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <main class="main-content">
            <!-- æˆ‘çš„æ–‡ä»¶é¡µé¢ -->
            <div v-if="currentView === 'myfiles' && user" class="myfiles-view">
                <!-- é¡µé¢é¡¶éƒ¨åŒºåŸŸ -->
                <div class="page-hero">
                    <div class="page-hero-content">
                        <h1 class="page-title">ğŸ“ æˆ‘çš„æ–‡ä»¶</h1>
                        <p class="page-subtitle">ç®¡ç†æ‚¨çš„ä¸ªäººæ–‡ä»¶ï¼Œè½»æ¾åˆ†äº«å’Œç»„ç»‡</p>
                    </div>
                    <div class="storage-overview">
                        <div class="storage-visual">
                            <div class="storage-circle">
                                <svg viewBox="0 0 42 42" class="storage-chart">
                                    <circle cx="21" cy="21" r="15.915" fill="transparent" stroke="rgba(255,255,255,0.2)" stroke-width="3"></circle>
                                    <circle cx="21" cy="21" r="15.915" fill="transparent" stroke="url(#gradient)" stroke-width="3" 
                                            :stroke-dasharray="`${storageUsagePercent} ${100 - storageUsagePercent}`" 
                                            stroke-dashoffset="25" transform="rotate(-90 21 21)"></circle>
                                    <defs>
                                        <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                            <stop offset="0%" style="stop-color:#667eea"/>
                                            <stop offset="100%" style="stop-color:#764ba2"/>
                                        </linearGradient>
                                    </defs>
                                </svg>
                                <div class="storage-percentage">{{ storageUsagePercent.toFixed(0) }}%</div>
                            </div>
                        </div>
                        <div class="storage-details">
                            <div class="storage-stat">
                                <span class="stat-label">å·²ä½¿ç”¨</span>
                                <span class="stat-value">{{ formatFileSize(storageUsed) }}</span>
                            </div>
                            <div class="storage-stat">
                                <span class="stat-label">æ€»å®¹é‡</span>
                                <span class="stat-value">{{ formatFileSize(storageQuota) }}</span>
                            </div>
                            <div class="storage-stat">
                                <span class="stat-label">å‰©ä½™ç©ºé—´</span>
                                <span class="stat-value">{{ formatFileSize(storageQuota - storageUsed) }}</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- æ“ä½œæ  -->
                <div class="action-bar">
                    <div class="action-left">
                        <button @click="showUploadModal = true" class="primary-action-btn">
                            ğŸ“¤ ä¸Šä¼ æ–‡ä»¶
                        </button>
                        <div class="file-count">
                            {{ filteredMyFiles.length }} ä¸ªæ–‡ä»¶
                        </div>
                    </div>
                    <div class="action-right">
                        <div class="search-container">
                            <input v-model="fileFilter" type="text" placeholder="ğŸ” æœç´¢æ–‡ä»¶..." class="modern-search">
                        </div>
                        <select v-model="fileCategory" class="modern-select">
                            <option value="">ğŸ“‚ æ‰€æœ‰åˆ†ç±»</option>
                            <option value="documents">ğŸ“„ æ–‡æ¡£</option>
                            <option value="images">ğŸ–¼ï¸ å›¾ç‰‡</option>
                            <option value="videos">ğŸ¬ è§†é¢‘</option>
                            <option value="others">ğŸ“¦ å…¶ä»–</option>
                        </select>
                        <div class="view-toggle">
                            <button @click="viewMode = 'grid'" :class="{'active': viewMode === 'grid'}" class="view-btn">âŠ</button>
                            <button @click="viewMode = 'list'" :class="{'active': viewMode === 'list'}" class="view-btn">â˜°</button>
                        </div>
                    </div>
                </div>

                <!-- æ–‡ä»¶ç½‘æ ¼ -->
                <div class="files-container">
                    <div v-if="viewMode === 'grid'" class="files-grid modern-grid">
                        <div v-for="file in filteredMyFiles" :key="file.id" class="modern-file-card">
                            <div class="file-thumbnail">
                                <div class="file-icon-large">{{ getFileIcon(file.filename) }}</div>
                                <div class="file-overlay">
                                    <button @click="previewFile(file)" class="overlay-btn">ğŸ‘ï¸</button>
                                    <button @click="downloadFile(file)" class="overlay-btn">ğŸ’¾</button>
                                </div>
                            </div>
                            <div class="file-details">
                                <h4 class="file-name">{{ file.filename }}</h4>
                                <div class="file-meta">
                                    <span class="file-size">{{ formatFileSize(file.size) }}</span>
                                    <span class="file-date">{{ formatDateShort(file.upload_time) }}</span>
                                </div>
                                <div class="file-badges">
                                    <span v-if="file.is_shared" class="badge shared">ğŸŒ å·²åˆ†äº«</span>
                                    <span v-else class="badge private">ğŸ”’ ç§æœ‰</span>
                                    <span class="badge category">{{ getCategoryName(file.category) }}</span>
                                </div>
                            </div>
                            <div class="file-actions-menu">
                                <button @click="toggleShare(file)" class="action-menu-btn" :class="{'shared': file.is_shared}">
                                    {{ file.is_shared ? 'ğŸš« å–æ¶ˆåˆ†äº«' : 'ğŸŒ åˆ†äº«' }}
                                </button>
                                <button @click="deleteMyFile(file)" class="action-menu-btn danger">ğŸ—‘ï¸ åˆ é™¤</button>
                            </div>
                        </div>
                    </div>

                    <div v-if="viewMode === 'list'" class="files-list modern-list">
                        <div class="list-header">
                            <span class="col-name">æ–‡ä»¶å</span>
                            <span class="col-size">å¤§å°</span>
                            <span class="col-date">ä¿®æ”¹æ—¶é—´</span>
                            <span class="col-status">çŠ¶æ€</span>
                            <span class="col-actions">æ“ä½œ</span>
                        </div>
                        <div v-for="file in filteredMyFiles" :key="file.id" class="list-item">
                            <div class="col-name">
                                <span class="file-icon-small">{{ getFileIcon(file.filename) }}</span>
                                <span class="file-title">{{ file.filename }}</span>
                            </div>
                            <div class="col-size">{{ formatFileSize(file.size) }}</div>
                            <div class="col-date">{{ formatDate(file.upload_time) }}</div>
                            <div class="col-status">
                                <span v-if="file.is_shared" class="status-badge shared">ğŸŒ å·²åˆ†äº«</span>
                                <span v-else class="status-badge private">ğŸ”’ ç§æœ‰</span>
                            </div>
                            <div class="col-actions">
                                <button @click="previewFile(file)" class="list-action-btn">ğŸ‘ï¸</button>
                                <button @click="downloadFile(file)" class="list-action-btn">ğŸ’¾</button>
                                <button @click="toggleShare(file)" class="list-action-btn">{{ file.is_shared ? 'ğŸš«' : 'ğŸŒ' }}</button>
                                <button @click="deleteMyFile(file)" class="list-action-btn danger">ğŸ—‘ï¸</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ç©ºçŠ¶æ€ -->
                <div v-if="filteredMyFiles.length === 0" class="empty-state modern-empty">
                    <div class="empty-illustration">
                        <div class="empty-cloud">â˜ï¸</div>
                        <div class="empty-files">ğŸ“‚ğŸ“„ğŸ“·</div>
                    </div>
                    <h3 class="empty-title">{{ fileFilter ? 'æœªæ‰¾åˆ°åŒ¹é…æ–‡ä»¶' : 'å¼€å§‹æ‚¨çš„æ–‡ä»¶ä¹‹æ—…' }}</h3>
                    <p class="empty-description">
                        {{ fileFilter ? 'å°è¯•è°ƒæ•´æœç´¢æ¡ä»¶æˆ–æ¸…ç©ºç­›é€‰å™¨' : 'ä¸Šä¼ ç¬¬ä¸€ä¸ªæ–‡ä»¶ï¼Œå¼€å§‹ä½¿ç”¨æ‚¨çš„ä¸ªäººç½‘ç›˜' }}
                    </p>
                    <button v-if="!fileFilter" @click="showUploadModal = true" class="empty-action-btn">
                        ğŸ“¤ ç«‹å³ä¸Šä¼ 
                    </button>
                </div>
            </div>

            <!-- å…¬å…±åˆ†äº«é¡µé¢ -->
            <div v-if="currentView === 'shared'" class="shared-view">
                <!-- é¡µé¢é¡¶éƒ¨åŒºåŸŸ -->
                <div class="page-hero">
                    <div class="page-hero-content">
                        <h1 class="page-title">ğŸŒ å…¬å…±åˆ†äº«</h1>
                        <p class="page-subtitle">å‘ç°ç¤¾åŒºä¸­å…¶ä»–ç”¨æˆ·åˆ†äº«çš„ç²¾å½©å†…å®¹</p>
                    </div>
                    <div class="share-stats">
                        <div class="stat-item">
                            <div class="stat-icon">ğŸ“</div>
                            <div class="stat-info">
                                <div class="stat-number">{{ sharedFiles.length }}</div>
                                <div class="stat-label">åˆ†äº«æ–‡ä»¶</div>
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-icon">ğŸ‘¥</div>
                            <div class="stat-info">
                                <div class="stat-number">{{ getUniqueUploaders() }}</div>
                                <div class="stat-label">è´¡çŒ®è€…</div>
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-icon">ğŸ“Š</div>
                            <div class="stat-info">
                                <div class="stat-number">{{ formatFileSize(getTotalSharedSize()) }}</div>
                                <div class="stat-label">æ€»å¤§å°</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- æ“ä½œæ  -->
                <div class="action-bar">
                    <div class="action-left">
                        <div class="file-count">
                            {{ filteredSharedFiles.length }} ä¸ªåˆ†äº«æ–‡ä»¶
                        </div>
                        <div class="sort-options">
                            <button @click="sharedSortBy = 'latest'" :class="{'active': sharedSortBy === 'latest'}" class="sort-btn">
                                ğŸ•’ æœ€æ–°
                            </button>
                            <button @click="sharedSortBy = 'popular'" :class="{'active': sharedSortBy === 'popular'}" class="sort-btn">
                                ğŸ”¥ çƒ­é—¨
                            </button>
                            <button @click="sharedSortBy = 'size'" :class="{'active': sharedSortBy === 'size'}" class="sort-btn">
                                ğŸ“ å¤§å°
                            </button>
                        </div>
                    </div>
                    <div class="action-right">
                        <div class="search-container">
                            <input v-model="sharedFilter" type="text" placeholder="ğŸ” æœç´¢åˆ†äº«æ–‡ä»¶..." class="modern-search">
                        </div>
                        <select v-model="sharedCategory" class="modern-select">
                            <option value="">ğŸ“‚ æ‰€æœ‰åˆ†ç±»</option>
                            <option value="documents">ğŸ“„ æ–‡æ¡£</option>
                            <option value="images">ğŸ–¼ï¸ å›¾ç‰‡</option>
                            <option value="videos">ğŸ¬ è§†é¢‘</option>
                            <option value="others">ğŸ“¦ å…¶ä»–</option>
                        </select>
                        <div class="view-toggle">
                            <button @click="sharedViewMode = 'grid'" :class="{'active': sharedViewMode === 'grid'}" class="view-btn">âŠ</button>
                            <button @click="sharedViewMode = 'list'" :class="{'active': sharedViewMode === 'list'}" class="view-btn">â˜°</button>
                        </div>
                    </div>
                </div>

                <!-- æ–‡ä»¶å±•ç¤ºåŒºåŸŸ -->
                <div class="files-container">
                    <div v-if="sharedViewMode === 'grid'" class="files-grid modern-grid shared-grid">
                        <div v-for="file in filteredSharedFiles" :key="file.id" class="modern-file-card shared-card">
                            <div class="file-thumbnail">
                                <div class="file-icon-large">{{ getFileIcon(file.filename) }}</div>
                                <div class="file-overlay">
                                    <button @click="previewFile(file)" class="overlay-btn">ğŸ‘ï¸</button>
                                    <button @click="downloadFile(file)" class="overlay-btn">ğŸ’¾</button>
                                </div>
                                <div class="share-indicator">ğŸŒ</div>
                            </div>
                            <div class="file-details">
                                <h4 class="file-name">{{ file.filename }}</h4>
                                <div class="file-meta">
                                    <span class="file-size">{{ formatFileSize(file.size) }}</span>
                                    <span class="file-uploader">ğŸ‘¤ {{ file.uploader }}</span>
                                </div>
                                <div class="file-badges">
                                    <span class="badge shared-time">ğŸ•’ {{ formatDateShort(file.shared_at || file.upload_time) }}</span>
                                    <span class="badge category">{{ getCategoryName(file.category) }}</span>
                                </div>
                            </div>
                            <div class="file-actions-menu">
                                <button @click="previewFile(file)" class="action-menu-btn primary">ğŸ‘ï¸ é¢„è§ˆ</button>
                                <button @click="downloadFile(file)" class="action-menu-btn">ğŸ’¾ ä¸‹è½½</button>
                            </div>
                        </div>
                    </div>

                    <div v-if="sharedViewMode === 'list'" class="files-list modern-list shared-list">
                        <div class="list-header">
                            <span class="col-name">æ–‡ä»¶å</span>
                            <span class="col-size">å¤§å°</span>
                            <span class="col-uploader">åˆ†äº«è€…</span>
                            <span class="col-date">åˆ†äº«æ—¶é—´</span>
                            <span class="col-actions">æ“ä½œ</span>
                        </div>
                        <div v-for="file in filteredSharedFiles" :key="file.id" class="list-item shared-item">
                            <div class="col-name">
                                <span class="file-icon-small">{{ getFileIcon(file.filename) }}</span>
                                <span class="file-title">{{ file.filename }}</span>
                                <span class="share-badge">ğŸŒ</span>
                            </div>
                            <div class="col-size">{{ formatFileSize(file.size) }}</div>
                            <div class="col-uploader">
                                <span class="uploader-name">ğŸ‘¤ {{ file.uploader }}</span>
                            </div>
                            <div class="col-date">{{ formatDate(file.shared_at || file.upload_time) }}</div>
                            <div class="col-actions">
                                <button @click="previewFile(file)" class="list-action-btn primary">ğŸ‘ï¸</button>
                                <button @click="downloadFile(file)" class="list-action-btn">ğŸ’¾</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ç©ºçŠ¶æ€ -->
                <div v-if="filteredSharedFiles.length === 0" class="empty-state modern-empty">
                    <div class="empty-illustration">
                        <div class="empty-world">ğŸŒ</div>
                        <div class="empty-share-icons">ğŸ¤ğŸ“¤ğŸ”—</div>
                    </div>
                    <h3 class="empty-title">{{ sharedFilter ? 'æœªæ‰¾åˆ°åŒ¹é…çš„åˆ†äº«æ–‡ä»¶' : 'ç­‰å¾…ç²¾å½©åˆ†äº«' }}</h3>
                    <p class="empty-description">
                        {{ sharedFilter ? 'å°è¯•è°ƒæ•´æœç´¢æ¡ä»¶æˆ–ç­›é€‰å™¨' : 'ç¤¾åŒºç”¨æˆ·è¿˜æ²¡æœ‰åˆ†äº«æ–‡ä»¶ï¼Œæˆä¸ºç¬¬ä¸€ä¸ªåˆ†äº«è€…å§ï¼' }}
                    </p>
                    <div class="empty-actions">
                        <button v-if="user" @click="currentView = 'myfiles'" class="empty-action-btn">
                            ğŸ“ å»åˆ†äº«æ–‡ä»¶
                        </button>
                        <button v-if="!user" @click="showLoginModal = true" class="empty-action-btn secondary">
                            ğŸ”‘ ç™»å½•ååˆ†äº«
                        </button>
                    </div>
                </div>
            </div>

            <!-- é¦–é¡µè§†å›¾ -->
            <div v-if="currentView === 'home'" class="home-view">
                <div class="hero-section">
                    <div class="hero-content">
                        <h1 class="hero-title">ğŸ‰ æ¬¢è¿æ¥åˆ° 112ç½‘ç›˜</h1>
                        <p class="hero-subtitle">ç°ä»£åŒ–çš„æ–‡ä»¶å­˜å‚¨ä¸åˆ†äº«å¹³å°ï¼Œè®©æ–‡ä»¶ç®¡ç†å˜å¾—ç®€å•è€Œä¼˜é›…</p>
                        <div class="hero-actions">
                            <button v-if="!user" @click="showLoginModal = true" class="hero-btn primary">
                                ğŸ”‘ ç«‹å³ç™»å½•
                            </button>
                            <button v-if="!user" @click="showLoginModal = true; showRegisterForm = true" class="hero-btn secondary">
                                ğŸ“‹ å…è´¹æ³¨å†Œ
                            </button>
                            <button v-if="user" @click="currentView = 'myfiles'" class="hero-btn primary">
                                ğŸ“ æˆ‘çš„æ–‡ä»¶
                            </button>
                            <button @click="currentView = 'shared'" class="hero-btn secondary">
                                ğŸŒ æµè§ˆåˆ†äº«
                            </button>
                        </div>
                    </div>
                    <div class="hero-image">
                        <div class="floating-cards">
                            <div class="float-card card-1">ğŸ“„</div>
                            <div class="float-card card-2">ğŸ–¼ï¸</div>
                            <div class="float-card card-3">ğŸ¬</div>
                            <div class="float-card card-4">ğŸ“Š</div>
                            <div class="float-card card-5">ğŸµ</div>
                            <div class="float-card card-6">ğŸ“¦</div>
                        </div>
                    </div>
                </div>

                <div class="stats-section">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">ğŸ“</div>
                            <div class="stat-info">
                                <h3>{{ totalFiles }}</h3>
                                <p>å…±äº«æ–‡ä»¶</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">ğŸ‘¥</div>
                            <div class="stat-info">
                                <h3>{{ onlineUsers }}</h3>
                                <p>åœ¨çº¿ç”¨æˆ·</p>
                            </div>
                        </div>
                        <div class="stat-card" v-if="systemStatus">
                            <div class="stat-icon">ğŸ’¾</div>
                            <div class="stat-info">
                                <h3>{{ parseFloat(systemStatus.disk_usage || 0).toFixed(1) }}%</h3>
                                <p>ç£ç›˜ä½¿ç”¨ç‡</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">ğŸŒŸ</div>
                            <div class="stat-info">
                                <h3>1GB</h3>
                                <p>å…è´¹ç©ºé—´</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="features-section">
                    <h2 class="section-title">âœ¨ æ ¸å¿ƒåŠŸèƒ½</h2>
                    <div class="features-grid">
                        <div class="feature-card">
                            <div class="feature-icon">ğŸ“</div>
                            <h3>ä¸ªäººæ–‡ä»¶ç®¡ç†</h3>
                            <p>1GBå…è´¹å­˜å‚¨ç©ºé—´ï¼Œæ”¯æŒå¤šç§æ–‡ä»¶æ ¼å¼ä¸Šä¼ ï¼Œæ™ºèƒ½åˆ†ç±»ç®¡ç†</p>
                            <ul class="feature-list">
                                <li>ğŸš€ æ‹–æ‹½ä¸Šä¼ </li>
                                <li>ğŸ‘ï¸ åœ¨çº¿é¢„è§ˆ</li>
                                <li>ğŸ“Š å­˜å‚¨ç›‘æ§</li>
                            </ul>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">ğŸŒ</div>
                            <h3>ä¾¿æ·åˆ†äº«</h3>
                            <p>ä¸€é”®åˆ†äº«æ–‡ä»¶ç»™å…¶ä»–ç”¨æˆ·ï¼Œçµæ´»æ§åˆ¶åˆ†äº«æƒé™</p>
                            <ul class="feature-list">
                                <li>ğŸ”„ ä¸€é”®åˆ†äº«</li>
                                <li>ğŸ”’ æƒé™æ§åˆ¶</li>
                                <li>ğŸ“ˆ åˆ†äº«ç»Ÿè®¡</li>
                            </ul>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">ğŸ”’</div>
                            <h3>å®‰å…¨å¯é </h3>
                            <p>æ–‡ä»¶ç§æœ‰å­˜å‚¨ï¼Œå®Œå…¨æŒæ§åˆ†äº«æƒé™ï¼Œæ•°æ®å®‰å…¨æœ‰ä¿éšœ</p>
                            <ul class="feature-list">
                                <li>ğŸ›¡ï¸ æ•°æ®åŠ å¯†</li>
                                <li>ğŸ‘¤ ç”¨æˆ·éš”ç¦»</li>
                                <li>ğŸ“ æ“ä½œæ—¥å¿—</li>
                            </ul>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">ğŸ“±</div>
                            <h3>å“åº”å¼è®¾è®¡</h3>
                            <p>å®Œç¾é€‚é…æ¡Œé¢å’Œç§»åŠ¨è®¾å¤‡ï¼Œéšæ—¶éšåœ°è®¿é—®æ‚¨çš„æ–‡ä»¶</p>
                            <ul class="feature-list">
                                <li>ğŸ’» æ¡Œé¢ä¼˜åŒ–</li>
                                <li>ğŸ“± ç§»åŠ¨é€‚é…</li>
                                <li>âš¡ å¿«é€Ÿå“åº”</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="recent-section" v-if="recentFiles.length > 0">
                    <h2 class="section-title">ğŸ“‹ æœ€æ–°åˆ†äº«</h2>
                    <div class="recent-grid">
                        <div v-for="file in recentFiles" :key="file.id" class="recent-card">
                            <div class="file-icon">{{ getFileIcon(file.filename) }}</div>
                            <div class="file-info">
                                <h4>{{ file.filename }}</h4>
                                <p>{{ formatFileSize(file.size) }} Â· {{ file.uploader }}</p>
                                <span class="upload-time">{{ formatDate(file.upload_time) }}</span>
                            </div>
                            <div class="file-actions">
                                <button @click="previewFile(file)" class="action-btn preview-btn">ğŸ‘ï¸</button>
                                <button @click="downloadFile(file)" class="action-btn download-btn">ğŸ’¾</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æœªç™»å½•çŠ¶æ€çš„ç®€åŒ–æ¬¢è¿é¡µé¢ -->
            <div v-if="!user && currentView !== 'shared' && currentView !== 'home'" class="welcome-view">
                <div class="welcome-content">
                    <h2>ğŸ‰ æ¬¢è¿ä½¿ç”¨ 112ç½‘ç›˜</h2>
                    <p class="welcome-desc">å®‰å…¨ä¾¿æ·çš„æ–‡ä»¶å­˜å‚¨ä¸åˆ†äº«å¹³å°</p>
                    
                    <div class="welcome-actions">
                        <button @click="currentView = 'home'" class="primary-btn">ğŸ  è¿”å›é¦–é¡µ</button>
                        <button @click="currentView = 'shared'" class="secondary-btn">ğŸŒ æµè§ˆåˆ†äº«</button>
                    </div>
                </div>
            </div>

            <!-- ç³»ç»Ÿç›‘æ§è§†å›¾ -->
            <div v-if="currentView === 'monitor' && user && user.role === 'admin'" class="monitor-view">
                <h2>ğŸ“Š ç³»ç»Ÿç›‘æ§</h2>
                
                <div class="monitor-cards">
                    <div class="monitor-card">
                        <h3>ğŸ’» CPU ä½¿ç”¨ç‡</h3>
                        <div class="progress-bar">
                            <div class="progress-fill" :style="{width: systemStatus.cpu_usage + '%'}"></div>
                        </div>
                        <p>{{ parseFloat(systemStatus.cpu_usage || 0).toFixed(1) }}%</p>
                    </div>
                    
                    <div class="monitor-card">
                        <h3>ğŸ’¾ å†…å­˜ä½¿ç”¨ç‡</h3>
                        <div class="progress-bar">
                            <div class="progress-fill" :style="{width: systemStatus.memory_usage + '%'}"></div>
                        </div>
                        <p>{{ parseFloat(systemStatus.memory_usage || 0).toFixed(1) }}%</p>
                    </div>
                    
                    <div class="monitor-card">
                        <h3>ğŸ—‚ï¸ ç£ç›˜ä½¿ç”¨ç‡</h3>
                        <div class="progress-bar">
                            <div class="progress-fill" :style="{width: systemStatus.disk_usage + '%'}"></div>
                        </div>
                        <p>{{ parseFloat(systemStatus.disk_usage || 0).toFixed(1) }}%</p>
                    </div>
                </div>

                <div class="processes-section">
                    <h3>ğŸ”„ è¿›ç¨‹åˆ—è¡¨</h3>
                    <div class="processes-controls">
                        <div class="search-bar">
                            <input v-model="processFilter" type="text" placeholder="ğŸ” æœç´¢è¿›ç¨‹å..." class="search-input">
                        </div>
                        <div class="sort-controls">
                            <label>æ’åºæ–¹å¼:</label>
                            <select v-model="processSortBy" @change="sortProcesses" class="sort-select">
                                <option value="cpu">CPUä½¿ç”¨ç‡ â¬‡ï¸</option>
                                <option value="memory">å†…å­˜ä½¿ç”¨ç‡ â¬‡ï¸</option>
                                <option value="name">è¿›ç¨‹å â¬†ï¸</option>
                                <option value="pid">PID â¬†ï¸</option>
                                <option value="user">ç”¨æˆ· â¬†ï¸</option>
                            </select>
                        </div>
                        <button @click="loadProcesses" class="refresh-btn">ğŸ”„ åˆ·æ–°</button>
                    </div>
                    <div class="processes-table">
                        <div class="table-header process-header">
                            <span>PID</span>
                            <span>è¿›ç¨‹å</span>
                            <span>ç”¨æˆ·</span>
                            <span>çŠ¶æ€</span>
                            <span>CPU%</span>
                            <span>å†…å­˜%</span>
                            <span>å†…å­˜(KB)</span>
                            <span>æ“ä½œ</span>
                        </div>
                        <div v-for="process in filteredProcesses" :key="process.pid" class="table-row process-row">
                            <span>{{ process.pid }}</span>
                            <span class="process-name">{{ process.name }}</span>
                            <span>{{ process.user }}</span>
                            <span :class="['status', process.status.toLowerCase()]">{{ process.status }}</span>
                            <span :class="['cpu-usage', getCpuClass(process.cpu)]">{{ process.cpu }}%</span>
                            <span :class="['memory-usage', getMemoryClass(process.memory)]">{{ process.memory }}%</span>
                            <span>{{ formatNumber(process.memory_kb) }}</span>
                            <span>
                                <button @click="killProcess(process.pid)" class="danger-btn">âŒ ç»ˆæ­¢</button>
                            </span>
                        </div>
                        <div v-if="filteredProcesses.length === 0" class="no-processes">
                            ğŸ” æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„è¿›ç¨‹
                        </div>
                    </div>
                </div>
            </div>

            <!-- ç®¡ç†é¢æ¿è§†å›¾ -->
            <div v-if="currentView === 'admin' && user && user.role === 'admin'" class="admin-view">
                <h2>âš™ï¸ ç®¡ç†é¢æ¿</h2>
                
                <div class="admin-sections">
                    <div class="admin-section">
                        <h3>ğŸ‘¥ ç”¨æˆ·ç®¡ç†</h3>
                        <div class="admin-table">
                            <div class="table-header">
                                <span>ID</span>
                                <span>ç”¨æˆ·å</span>
                                <span>è§’è‰²</span>
                                <span>æ³¨å†Œæ—¶é—´</span>
                                <span>å­˜å‚¨ä½¿ç”¨</span>
                                <span>çŠ¶æ€</span>
                                <span>æ“ä½œ</span>
                            </div>
                            <div v-for="user in adminUsers" :key="user.id" class="table-row">
                                <span>{{ user.id }}</span>
                                <span>{{ user.username }}</span>
                                <span>{{ user.role }}</span>
                                <span>{{ formatDate(user.created_at) }}</span>
                                <span>{{ formatFileSize(user.storage_used || 0) }} / {{ formatFileSize(user.storage_quota || 1073741824) }}</span>
                                <span>{{ user.active ? 'æ´»è·ƒ' : 'ç¦ç”¨' }}</span>
                                <span>
                                    <button v-if="user.id !== 1" @click="deleteUser(user.id)" class="danger-btn">
                                        ğŸ—‘ï¸ åˆ é™¤
                                    </button>
                                    <span v-else class="protected-user">ç³»ç»Ÿç®¡ç†å‘˜</span>
                                </span>
                            </div>
                        </div>
                        <button @click="loadAdminUsers" class="refresh-btn">ğŸ”„ åˆ·æ–°ç”¨æˆ·åˆ—è¡¨</button>
                    </div>

                    <div class="admin-section">
                        <h3>ğŸ“ æ–‡ä»¶ç®¡ç†</h3>
                        <div class="admin-table">
                            <div class="table-header">
                                <span>ID</span>
                                <span>æ–‡ä»¶å</span>
                                <span>åˆ†ç±»</span>
                                <span>å¤§å°</span>
                                <span>ä¸Šä¼ è€…</span>
                                <span>åˆ†äº«çŠ¶æ€</span>
                                <span>ä¸Šä¼ æ—¶é—´</span>
                                <span>æ“ä½œ</span>
                            </div>
                            <div v-for="file in adminFiles" :key="file.id" class="table-row">
                                <span>{{ file.id }}</span>
                                <span>{{ file.filename }}</span>
                                <span>{{ file.category }}</span>
                                <span>{{ formatFileSize(file.size) }}</span>
                                <span>{{ file.uploader }}</span>
                                <span>
                                    <span v-if="file.is_shared" class="shared-badge">ğŸŒ å·²åˆ†äº«</span>
                                    <span v-else class="private-badge">ğŸ”’ ç§æœ‰</span>
                                </span>
                                <span>{{ formatDate(file.upload_time) }}</span>
                                <span>
                                    <button @click="deleteAdminFile(file.id)" class="danger-btn">
                                        ğŸ—‘ï¸ åˆ é™¤
                                    </button>
                                </span>
                            </div>
                        </div>
                        <button @click="loadAdminFiles" class="refresh-btn">ğŸ”„ åˆ·æ–°æ–‡ä»¶åˆ—è¡¨</button>
                    </div>
                </div>
            </div>
        </main>

        <!-- ç™»å½•æ¨¡æ€æ¡† -->
        <div v-if="showLoginModal" class="modal-overlay" @click="showLoginModal = false">
            <div class="modal" @click.stop>
                <div class="modal-header">
                    <h3>{{ showRegisterForm ? 'ğŸ“ ç”¨æˆ·æ³¨å†Œ' : 'ğŸ”‘ ç”¨æˆ·ç™»å½•' }}</h3>
                    <button @click="showLoginModal = false; showRegisterForm = false" class="close-btn">âœ–ï¸</button>
                </div>
                <div class="modal-body">
                    <!-- ç™»å½•è¡¨å• -->
                    <form v-if="!showRegisterForm" @submit.prevent="login">
                        <div class="form-group">
                            <label>ç”¨æˆ·å:</label>
                            <input v-model="loginForm.username" type="text" required>
                        </div>
                        <div class="form-group">
                            <label>å¯†ç :</label>
                            <input v-model="loginForm.password" type="password" required>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="submit-btn">ğŸš€ ç™»å½•</button>
                            <button type="button" @click="showRegisterForm = true" class="text-btn">
                                è¿˜æ²¡æœ‰è´¦æˆ·ï¼Ÿç‚¹å‡»æ³¨å†Œ
                            </button>
                        </div>
                    </form>

                    <!-- æ³¨å†Œè¡¨å• -->
                    <form v-if="showRegisterForm" @submit.prevent="register" class="register-form">
                        <h4>ğŸ“ ç”¨æˆ·æ³¨å†Œ</h4>
                        <div class="form-group">
                            <label>ç”¨æˆ·å (æœ€å°‘3ä¸ªå­—ç¬¦):</label>
                            <input v-model="registerForm.username" type="text" required minlength="3">
                        </div>
                        <div class="form-group">
                            <label>å¯†ç  (æœ€å°‘6ä¸ªå­—ç¬¦):</label>
                            <input v-model="registerForm.password" type="password" required minlength="6">
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="submit-btn">ğŸ“‹ æ³¨å†Œ</button>
                            <button type="button" @click="showRegisterForm = false" class="text-btn">
                                è¿”å›ç™»å½•
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- æ–‡ä»¶ä¸Šä¼ æ¨¡æ€æ¡† -->
        <div v-if="showUploadModal" class="modal-overlay" @click="showUploadModal = false">
            <div class="modal" @click.stop>
                <div class="modal-header">
                    <h3>ğŸ“¤ æ–‡ä»¶ä¸Šä¼ </h3>
                    <button @click="showUploadModal = false" class="close-btn">âœ–ï¸</button>
                </div>
                <div class="modal-body">
                    <div class="storage-warning" v-if="storageUsagePercent > 90">
                        âš ï¸ å­˜å‚¨ç©ºé—´ä¸è¶³ï¼Œå‰©ä½™ {{ formatFileSize(storageQuota - storageUsed) }}
                    </div>
                    
                    <div class="upload-area" @drop="handleFileDrop" @dragover.prevent @dragenter.prevent>
                        <div class="upload-icon">ğŸ“</div>
                        <p>æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„æˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</p>
                        <input type="file" @change="handleFileSelect" ref="fileInput" multiple style="display: none;">
                        <button @click="$refs.fileInput.click()" class="select-btn">é€‰æ‹©æ–‡ä»¶</button>
                    </div>
                    
                    <div v-if="uploadFiles.length > 0" class="upload-list">
                        <h4>å¾…ä¸Šä¼ æ–‡ä»¶:</h4>
                        <div v-for="(file, index) in uploadFiles" :key="index" class="upload-item">
                            <span>{{ file.name }} ({{ formatFileSize(file.size) }})</span>
                            <select v-model="uploadCategories[index]" class="category-select">
                                <option value="documents">ğŸ“„ æ–‡æ¡£</option>
                                <option value="images">ğŸ–¼ï¸ å›¾ç‰‡</option>
                                <option value="videos">ğŸ¬ è§†é¢‘</option>
                                <option value="others">ğŸ“¦ å…¶ä»–</option>
                            </select>
                            <button @click="removeFile(index)" class="remove-btn">âŒ</button>
                        </div>
                        <button @click="uploadSelectedFiles" class="upload-submit-btn" :disabled="uploading">
                            {{ uploading ? 'ğŸ”„ ä¸Šä¼ ä¸­...' : 'ğŸš€ å¼€å§‹ä¸Šä¼ ' }}
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ–‡ä»¶é¢„è§ˆæ¨¡æ€æ¡† -->
        <div v-if="showPreviewModal && previewFileData" class="modal-overlay" @click="showPreviewModal = false">
            <div class="modal preview-modal" @click.stop>
                <div class="modal-header">
                    <h3>ğŸ‘ï¸ æ–‡ä»¶é¢„è§ˆ - {{ previewFileData.filename }}</h3>
                    <button @click="showPreviewModal = false" class="close-btn">âœ–ï¸</button>
                </div>
                <div class="modal-body">
                    <div v-if="isImageFile(previewFileData.filename)" class="image-preview">
                        <img :src="`/api/download?id=${previewFileData.id}`" :alt="previewFileData.filename" style="max-width: 100%; max-height: 500px;">
                    </div>
                    <div v-else-if="isVideoFile(previewFileData.filename)" class="video-preview">
                        <video controls style="max-width: 100%; max-height: 500px;">
                            <source :src="`/api/download?id=${previewFileData.id}`" :type="previewFileData.mime_type">
                            æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘é¢„è§ˆ
                        </video>
                    </div>
                    <div v-else-if="isTextFile(previewFileData.filename)" class="text-preview">
                        <pre>{{ previewContent }}</pre>
                    </div>
                    <div v-else class="unsupported-preview">
                        <div class="unsupported-icon">ğŸ“„</div>
                        <p>{{ previewContent || 'æ­¤æ–‡ä»¶ç±»å‹ä¸æ”¯æŒé¢„è§ˆ' }}</p>
                        <button @click="downloadFile(previewFileData)" class="download-btn">ğŸ’¾ ä¸‹è½½æŸ¥çœ‹</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ¶ˆæ¯æç¤º -->
        <div v-if="message" :class="['message', message.type]" @click="message = null">
            {{ message.text }}
        </div>
    </div>

    <script src="/js/app.js"></script>
</body>
</html> 