<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>g00j小站 - 文件共享系统</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>
<body>
    <div id="app">
        <!-- 导航栏 -->
        <nav class="navbar">
            <div class="nav-container">
                <div class="nav-brand">
                    <h1>📁 g00j小站</h1>
                </div>
                <div class="nav-menu">
                    <a href="#" @click="currentView = 'home'" :class="{active: currentView === 'home'}">首页</a>
                    <a href="#" @click="currentView = 'files'" :class="{active: currentView === 'files'}">文件管理</a>
                    <a href="#" @click="currentView = 'monitor'" v-if="user && user.role === 'admin'" :class="{active: currentView === 'monitor'}">系统监控</a>
                </div>
                <div class="nav-auth">
                    <div v-if="!user">
                        <button @click="showLogin = true" class="btn btn-primary">登录</button>
                        <button @click="showRegister = true" class="btn btn-secondary">注册</button>
                    </div>
                    <div v-else class="user-info">
                        <span>欢迎, {{ user.username }} ({{ user.role }})</span>
                        <button @click="logout" class="btn btn-danger">登出</button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- 主内容区域 -->
        <main class="main-content">
            <!-- 首页视图 -->
            <div v-if="currentView === 'home'" class="home-view">
                <div class="hero-section">
                    <h2>欢迎使用 g00j小站 文件共享系统</h2>
                    <p>一个安全、高效的文件共享平台</p>
                </div>
                
                <div class="features-grid">
                    <div class="feature-card">
                        <h3>📁 文件管理</h3>
                        <p>支持多种文件类型的上传、下载和预览</p>
                    </div>
                    <div class="feature-card">
                        <h3>🎥 在线播放</h3>
                        <p>支持视频在线播放和文档在线阅读</p>
                    </div>
                    <div class="feature-card">
                        <h3>🔐 权限管理</h3>
                        <p>三级用户权限，确保数据安全</p>
                    </div>
                    <div class="feature-card">
                        <h3>📊 系统监控</h3>
                        <p>实时监控系统资源使用情况</p>
                    </div>
                </div>

                <!-- 最新文件展示 -->
                <div class="recent-files">
                    <h3>最新共享文件</h3>
                    <div class="file-grid">
                        <div v-for="file in recentFiles" :key="file.id" class="file-item">
                            <div class="file-icon">{{ getFileIcon(file.file_type) }}</div>
                            <div class="file-info">
                                <h4>{{ file.filename }}</h4>
                                <p>{{ formatFileSize(file.file_size) }} | {{ file.upload_time }}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 文件管理视图 -->
            <div v-if="currentView === 'files'" class="files-view">
                <div class="files-header">
                    <h2>文件管理</h2>
                    <button v-if="user" @click="showUpload = true" class="btn btn-primary">上传文件</button>
                </div>

                <!-- 文件分类筛选 -->
                <div class="file-filters">
                    <button @click="filterCategory = ''" :class="{active: filterCategory === ''}" class="filter-btn">全部</button>
                    <button @click="filterCategory = 'video'" :class="{active: filterCategory === 'video'}" class="filter-btn">视频</button>
                    <button @click="filterCategory = 'document'" :class="{active: filterCategory === 'document'}" class="filter-btn">文档</button>
                    <button @click="filterCategory = 'image'" :class="{active: filterCategory === 'image'}" class="filter-btn">图片</button>
                    <button @click="filterCategory = 'other'" :class="{active: filterCategory === 'other'}" class="filter-btn">其他</button>
                </div>

                <!-- 文件列表 -->
                <div class="files-list">
                    <div v-for="file in filteredFiles" :key="file.id" class="file-row">
                        <div class="file-icon">{{ getFileIcon(file.file_type) }}</div>
                        <div class="file-name">{{ file.filename }}</div>
                        <div class="file-size">{{ formatFileSize(file.file_size) }}</div>
                        <div class="file-date">{{ file.upload_time }}</div>
                        <div class="file-actions">
                            <button @click="previewFile(file)" class="btn btn-sm btn-info">预览</button>
                            <button v-if="user" @click="downloadFile(file)" class="btn btn-sm btn-success">下载</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 系统监控视图 -->
            <div v-if="currentView === 'monitor' && user && user.role === 'admin'" class="monitor-view">
                <h2>系统监控</h2>
                
                <div class="monitor-grid">
                    <div class="monitor-card">
                        <h3>CPU 使用率</h3>
                        <div class="progress-circle">
                            <span class="progress-text">{{ systemStatus.cpu_usage }}%</span>
                        </div>
                    </div>
                    
                    <div class="monitor-card">
                        <h3>内存使用率</h3>
                        <div class="progress-circle">
                            <span class="progress-text">{{ systemStatus.memory_usage }}%</span>
                        </div>
                    </div>
                    
                    <div class="monitor-card">
                        <h3>磁盘使用率</h3>
                        <div class="progress-circle">
                            <span class="progress-text">{{ systemStatus.disk_usage }}%</span>
                        </div>
                    </div>
                    
                    <div class="monitor-card">
                        <h3>系统运行时间</h3>
                        <p>{{ systemStatus.uptime }}</p>
                    </div>
                </div>

                <!-- 进程列表 -->
                <div class="processes-section">
                    <h3>系统进程</h3>
                    <div class="processes-table">
                        <div class="table-header">
                            <span>PID</span>
                            <span>进程名</span>
                            <span>用户</span>
                            <span>CPU%</span>
                            <span>内存%</span>
                        </div>
                        <div v-for="process in processes.slice(0, 10)" :key="process.pid" class="table-row">
                            <span>{{ process.pid }}</span>
                            <span>{{ process.name }}</span>
                            <span>{{ process.user }}</span>
                            <span>{{ process.cpu_percent }}%</span>
                            <span>{{ process.memory_percent }}%</span>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- 登录模态框 -->
        <div v-if="showLogin" class="modal-overlay" @click="showLogin = false">
            <div class="modal" @click.stop>
                <h3>用户登录</h3>
                <form @submit.prevent="login">
                    <input v-model="loginForm.username" type="text" placeholder="用户名" required>
                    <input v-model="loginForm.password" type="password" placeholder="密码" required>
                    <button type="submit" class="btn btn-primary">登录</button>
                    <button type="button" @click="showLogin = false" class="btn btn-secondary">取消</button>
                </form>
            </div>
        </div>

        <!-- 注册模态框 -->
        <div v-if="showRegister" class="modal-overlay" @click="showRegister = false">
            <div class="modal" @click.stop>
                <h3>用户注册</h3>
                <form @submit.prevent="register">
                    <input v-model="registerForm.username" type="text" placeholder="用户名" required>
                    <input v-model="registerForm.password" type="password" placeholder="密码" required>
                    <input v-model="registerForm.confirmPassword" type="password" placeholder="确认密码" required>
                    <button type="submit" class="btn btn-primary">注册</button>
                    <button type="button" @click="showRegister = false" class="btn btn-secondary">取消</button>
                </form>
            </div>
        </div>

        <!-- 文件预览模态框 -->
        <div v-if="showPreview" class="modal-overlay" @click="showPreview = false">
            <div class="modal preview-modal" @click.stop>
                <h3>{{ previewFile.filename }}</h3>
                <div class="preview-content">
                    <div v-if="previewFile.file_type.startsWith('video/')" class="video-preview">
                        <video controls :src="`/api/stream/${previewFile.id}`"></video>
                    </div>
                    <div v-else-if="previewFile.file_type.startsWith('image/')" class="image-preview">
                        <img :src="`/api/stream/${previewFile.id}`" alt="预览图片">
                    </div>
                    <div v-else-if="previewFile.file_type.startsWith('text/')" class="text-preview">
                        <pre>{{ previewContent }}</pre>
                    </div>
                    <div v-else class="unsupported-preview">
                        <p>该文件类型不支持预览</p>
                    </div>
                </div>
                <button @click="showPreview = false" class="btn btn-secondary">关闭</button>
            </div>
        </div>
    </div>

    <script src="js/app.js"></script>
</body>
</html> 