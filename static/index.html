<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>g00jå°ç«™ - æ–‡ä»¶å…±äº«ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="/css/style.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>
<body>
    <div id="app">
        <!-- å¯¼èˆªæ  -->
        <nav class="navbar">
            <div class="nav-container">
                <div class="nav-brand">
                    <h1>ğŸ  g00jå°ç«™</h1>
                </div>
                <div class="nav-menu">
                    <button @click="currentView = 'home'" :class="{'active': currentView === 'home'}">
                        ğŸ¡ é¦–é¡µ
                    </button>
                    <button @click="currentView = 'files'" :class="{'active': currentView === 'files'}">
                        ğŸ“‚ æ–‡ä»¶ç®¡ç†
                    </button>
                    <button v-if="user && user.role === 'admin'" @click="currentView = 'monitor'" 
                            :class="{'active': currentView === 'monitor'}">
                        ğŸ“Š ç³»ç»Ÿç›‘æ§
                    </button>
                    <button v-if="user && user.role === 'admin'" @click="currentView = 'admin'" 
                            :class="{'active': currentView === 'admin'}">
                        âš™ï¸ ç®¡ç†é¢æ¿
                    </button>
                    <button v-if="!user" @click="showLoginModal = true" class="login-btn">
                        ğŸ”‘ ç™»å½•
                    </button>
                    <div v-if="user" class="user-menu">
                        <span>ğŸ‘¤ {{ user.username }}</span>
                        <button @click="logout" class="logout-btn">ğŸšª ç™»å‡º</button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <main class="main-content">
            <!-- é¦–é¡µè§†å›¾ -->
            <div v-if="currentView === 'home'" class="home-view">
                <div class="welcome-section">
                    <h2>ğŸ‰ æ¬¢è¿æ¥åˆ° g00jå°ç«™</h2>
                    <p>è½»é‡çº§æ–‡ä»¶å…±äº«å¹³å°ï¼Œæ”¯æŒè§†é¢‘æ’­æ”¾ã€æ–‡æ¡£é˜…è¯»ã€æ–‡ä»¶ç®¡ç†ç­‰å®Œæ•´åŠŸèƒ½</p>
                </div>
                
                <div class="stats-cards">
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ“</div>
                        <div class="stat-info">
                            <h3>{{ totalFiles }}</h3>
                            <p>å…±äº«æ–‡ä»¶</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ‘¥</div>
                        <div class="stat-info">
                            <h3>{{ onlineUsers }}</h3>
                            <p>åœ¨çº¿ç”¨æˆ·</p>
                        </div>
                    </div>
                    <div class="stat-card" v-if="systemStatus">
                        <div class="stat-icon">ğŸ’¾</div>
                        <div class="stat-info">
                            <h3>{{ parseFloat(systemStatus.disk_usage || 0).toFixed(1) }}%</h3>
                            <p>ç£ç›˜ä½¿ç”¨ç‡</p>
                        </div>
                    </div>
                </div>

                <div class="recent-files">
                    <h3>ğŸ“‹ æœ€æ–°æ–‡ä»¶</h3>
                    <div class="file-grid">
                        <div v-for="file in recentFiles" :key="file.id" class="file-card">
                            <div class="file-icon">{{ getFileIcon(file.category) }}</div>
                            <div class="file-info">
                                <h4>{{ file.filename }}</h4>
                                <p>{{ formatFileSize(file.size) }} Â· {{ formatDate(file.upload_time) }}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ–‡ä»¶ç®¡ç†è§†å›¾ -->
            <div v-if="currentView === 'files'" class="files-view">
                <div class="files-header">
                    <h2>ğŸ“‚ æ–‡ä»¶ç®¡ç†</h2>
                    <div class="files-actions">
                        <select v-model="currentCategory" @change="loadFiles">
                            <option value="">æ‰€æœ‰æ–‡ä»¶</option>
                            <option value="videos">è§†é¢‘æ–‡ä»¶</option>
                            <option value="images">å›¾ç‰‡æ–‡ä»¶</option>
                            <option value="documents">æ–‡æ¡£æ–‡ä»¶</option>
                            <option value="others">å…¶ä»–æ–‡ä»¶</option>
                        </select>
                        <button v-if="user" @click="showUploadModal = true" class="upload-btn">
                            ğŸ“¤ ä¸Šä¼ æ–‡ä»¶
                        </button>
                    </div>
                </div>

                <div class="files-list">
                    <div v-for="file in files" :key="file.id" class="file-item">
                        <div class="file-icon">{{ getFileIcon(file.category) }}</div>
                        <div class="file-details">
                            <h4>{{ file.filename }}</h4>
                            <p>{{ formatFileSize(file.size) }} Â· ä¸Šä¼ è€…: {{ file.uploader }} Â· {{ formatDate(file.upload_time) }}</p>
                        </div>
                        <div class="file-actions">
                            <button @click="previewFile(file)" class="preview-btn">ğŸ‘ï¸ é¢„è§ˆ</button>
                            <button v-if="user" @click="downloadFile(file)" class="download-btn">ğŸ’¾ ä¸‹è½½</button>
                        </div>
                    </div>
                </div>

                <!-- åˆ†é¡µ -->
                <div v-if="pagination.pages > 1" class="pagination">
                    <button @click="changePage(pagination.page - 1)" :disabled="pagination.page <= 1">
                        â¬…ï¸ ä¸Šä¸€é¡µ
                    </button>
                    <span>ç¬¬ {{ pagination.page }} é¡µ / å…± {{ pagination.pages }} é¡µ</span>
                    <button @click="changePage(pagination.page + 1)" :disabled="pagination.page >= pagination.pages">
                        ä¸‹ä¸€é¡µ â¡ï¸
                    </button>
                </div>
            </div>

            <!-- ç³»ç»Ÿç›‘æ§è§†å›¾ -->
            <div v-if="currentView === 'monitor' && user && user.role === 'admin'" class="monitor-view">
                <h2>ğŸ“Š ç³»ç»Ÿç›‘æ§</h2>
                
                <div class="monitor-cards">
                    <div class="monitor-card">
                        <h3>ğŸ’» CPU ä½¿ç”¨ç‡</h3>
                        <div class="progress-bar">
                            <div class="progress-fill" :style="{width: systemStatus.cpu_usage + '%'}"></div>
                        </div>
                        <p>{{ parseFloat(systemStatus.cpu_usage || 0).toFixed(1) }}%</p>
                    </div>
                    
                    <div class="monitor-card">
                        <h3>ğŸ’¾ å†…å­˜ä½¿ç”¨ç‡</h3>
                        <div class="progress-bar">
                            <div class="progress-fill" :style="{width: systemStatus.memory_usage + '%'}"></div>
                        </div>
                        <p>{{ parseFloat(systemStatus.memory_usage || 0).toFixed(1) }}%</p>
                    </div>
                    
                    <div class="monitor-card">
                        <h3>ğŸ—‚ï¸ ç£ç›˜ä½¿ç”¨ç‡</h3>
                        <div class="progress-bar">
                            <div class="progress-fill" :style="{width: systemStatus.disk_usage + '%'}"></div>
                        </div>
                        <p>{{ parseFloat(systemStatus.disk_usage || 0).toFixed(1) }}%</p>
                    </div>
                </div>

                <div class="processes-section">
                    <h3>ğŸ”„ è¿›ç¨‹åˆ—è¡¨</h3>
                    <div class="processes-controls">
                        <div class="search-bar">
                            <input v-model="processFilter" type="text" placeholder="ğŸ” æœç´¢è¿›ç¨‹å..." class="search-input">
                        </div>
                        <div class="sort-controls">
                            <label>æ’åºæ–¹å¼:</label>
                            <select v-model="processSortBy" @change="sortProcesses" class="sort-select">
                                <option value="cpu">CPUä½¿ç”¨ç‡ â¬‡ï¸</option>
                                <option value="memory">å†…å­˜ä½¿ç”¨ç‡ â¬‡ï¸</option>
                                <option value="name">è¿›ç¨‹å â¬†ï¸</option>
                                <option value="pid">PID â¬†ï¸</option>
                                <option value="user">ç”¨æˆ· â¬†ï¸</option>
                            </select>
                        </div>
                        <button @click="loadProcesses" class="refresh-btn">ğŸ”„ åˆ·æ–°</button>
                    </div>
                    <div class="processes-table">
                        <div class="table-header process-header">
                            <span>PID</span>
                            <span>è¿›ç¨‹å</span>
                            <span>ç”¨æˆ·</span>
                            <span>çŠ¶æ€</span>
                            <span>CPU%</span>
                            <span>å†…å­˜%</span>
                            <span>å†…å­˜(KB)</span>
                            <span>æ“ä½œ</span>
                        </div>
                        <div v-for="process in filteredProcesses" :key="process.pid" class="table-row process-row">
                            <span>{{ process.pid }}</span>
                            <span class="process-name">{{ process.name }}</span>
                            <span>{{ process.user }}</span>
                            <span :class="['status', process.status.toLowerCase()]">{{ process.status }}</span>
                            <span :class="['cpu-usage', getCpuClass(process.cpu)]">{{ process.cpu }}%</span>
                            <span :class="['memory-usage', getMemoryClass(process.memory)]">{{ process.memory }}%</span>
                            <span>{{ formatNumber(process.memory_kb) }}</span>
                            <span>
                                <button @click="killProcess(process.pid)" class="danger-btn">âŒ ç»ˆæ­¢</button>
                            </span>
                        </div>
                        <div v-if="filteredProcesses.length === 0" class="no-processes">
                            ğŸ” æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„è¿›ç¨‹
                        </div>
                    </div>
                </div>
            </div>

            <!-- ç®¡ç†é¢æ¿è§†å›¾ -->
            <div v-if="currentView === 'admin' && user && user.role === 'admin'" class="admin-view">
                <h2>âš™ï¸ ç®¡ç†é¢æ¿</h2>
                
                <div class="admin-sections">
                    <div class="admin-section">
                        <h3>ğŸ‘¥ ç”¨æˆ·ç®¡ç†</h3>
                        <div class="admin-table">
                            <div class="table-header">
                                <span>ID</span>
                                <span>ç”¨æˆ·å</span>
                                <span>è§’è‰²</span>
                                <span>æ³¨å†Œæ—¶é—´</span>
                                <span>çŠ¶æ€</span>
                                <span>æ“ä½œ</span>
                            </div>
                            <div v-for="user in adminUsers" :key="user.id" class="table-row">
                                <span>{{ user.id }}</span>
                                <span>{{ user.username }}</span>
                                <span>{{ user.role }}</span>
                                <span>{{ formatDate(user.created_at) }}</span>
                                <span>{{ user.active ? 'æ´»è·ƒ' : 'ç¦ç”¨' }}</span>
                                <span>
                                    <button v-if="user.id !== 1" @click="deleteUser(user.id)" class="danger-btn">
                                        ğŸ—‘ï¸ åˆ é™¤
                                    </button>
                                    <span v-else class="protected-user">ç³»ç»Ÿç®¡ç†å‘˜</span>
                                </span>
                            </div>
                        </div>
                        <button @click="loadAdminUsers" class="refresh-btn">ğŸ”„ åˆ·æ–°ç”¨æˆ·åˆ—è¡¨</button>
                    </div>

                    <div class="admin-section">
                        <h3>ğŸ“ æ–‡ä»¶ç®¡ç†</h3>
                        <div class="admin-table">
                            <div class="table-header">
                                <span>ID</span>
                                <span>æ–‡ä»¶å</span>
                                <span>åˆ†ç±»</span>
                                <span>å¤§å°</span>
                                <span>ä¸Šä¼ è€…</span>
                                <span>ä¸Šä¼ æ—¶é—´</span>
                                <span>æ“ä½œ</span>
                            </div>
                            <div v-for="file in adminFiles" :key="file.id" class="table-row">
                                <span>{{ file.id }}</span>
                                <span>{{ file.filename }}</span>
                                <span>{{ file.category }}</span>
                                <span>{{ formatFileSize(file.size) }}</span>
                                <span>{{ file.uploader }}</span>
                                <span>{{ formatDate(file.upload_time) }}</span>
                                <span>
                                    <button @click="deleteAdminFile(file.id)" class="danger-btn">
                                        ğŸ—‘ï¸ åˆ é™¤
                                    </button>
                                </span>
                            </div>
                        </div>
                        <button @click="loadAdminFiles" class="refresh-btn">ğŸ”„ åˆ·æ–°æ–‡ä»¶åˆ—è¡¨</button>
                    </div>
                </div>
            </div>
        </main>

        <!-- ç™»å½•æ¨¡æ€æ¡† -->
        <div v-if="showLoginModal" class="modal-overlay" @click="showLoginModal = false">
            <div class="modal" @click.stop>
                <div class="modal-header">
                    <h3>ğŸ”‘ ç”¨æˆ·ç™»å½•</h3>
                    <button @click="showLoginModal = false" class="close-btn">âœ–ï¸</button>
                </div>
                <div class="modal-body">
                    <form @submit.prevent="login">
                        <div class="form-group">
                            <label>ç”¨æˆ·å:</label>
                            <input v-model="loginForm.username" type="text" required>
                        </div>
                        <div class="form-group">
                            <label>å¯†ç :</label>
                            <input v-model="loginForm.password" type="password" required>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="submit-btn">ğŸš€ ç™»å½•</button>
                            <button type="button" @click="showRegisterForm = true" class="text-btn">
                                è¿˜æ²¡æœ‰è´¦æˆ·ï¼Ÿç‚¹å‡»æ³¨å†Œ
                            </button>
                        </div>
                    </form>

                    <form v-if="showRegisterForm" @submit.prevent="register" class="register-form">
                        <h4>ğŸ“ ç”¨æˆ·æ³¨å†Œ</h4>
                        <div class="form-group">
                            <label>ç”¨æˆ·å:</label>
                            <input v-model="registerForm.username" type="text" required>
                        </div>
                        <div class="form-group">
                            <label>å¯†ç :</label>
                            <input v-model="registerForm.password" type="password" required>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="submit-btn">ğŸ“‹ æ³¨å†Œ</button>
                            <button type="button" @click="showRegisterForm = false" class="text-btn">
                                è¿”å›ç™»å½•
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- æ–‡ä»¶ä¸Šä¼ æ¨¡æ€æ¡† -->
        <div v-if="showUploadModal" class="modal-overlay" @click="showUploadModal = false">
            <div class="modal" @click.stop>
                <div class="modal-header">
                    <h3>ğŸ“¤ æ–‡ä»¶ä¸Šä¼ </h3>
                    <button @click="showUploadModal = false" class="close-btn">âœ–ï¸</button>
                </div>
                <div class="modal-body">
                    <div class="upload-area" @drop="handleFileDrop" @dragover.prevent @dragenter.prevent>
                        <div class="upload-icon">ğŸ“</div>
                        <p>æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„æˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</p>
                        <input type="file" @change="handleFileSelect" ref="fileInput" multiple style="display: none;">
                        <button @click="$refs.fileInput.click()" class="select-btn">é€‰æ‹©æ–‡ä»¶</button>
                    </div>
                    <div v-if="uploadFiles.length > 0" class="upload-list">
                        <h4>å¾…ä¸Šä¼ æ–‡ä»¶:</h4>
                        <div v-for="(file, index) in uploadFiles" :key="index" class="upload-item">
                            <span>{{ file.name }} ({{ formatFileSize(file.size) }})</span>
                            <button @click="removeFile(index)" class="remove-btn">âŒ</button>
                        </div>
                        <button @click="uploadSelectedFiles" class="upload-submit-btn">ğŸš€ å¼€å§‹ä¸Šä¼ </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ–‡ä»¶é¢„è§ˆæ¨¡æ€æ¡† -->
        <div v-if="showPreviewModal" class="modal-overlay" @click="showPreviewModal = false">
            <div class="modal preview-modal" @click.stop>
                <div class="modal-header">
                    <h3>ğŸ‘ï¸ æ–‡ä»¶é¢„è§ˆ - {{ previewFileData.filename }}</h3>
                    <button @click="showPreviewModal = false" class="close-btn">âœ–ï¸</button>
                </div>
                <div class="modal-body">
                    <div v-if="isImageFile(previewFileData.filename)" class="image-preview">
                        <img :src="`/api/download?id=${previewFileData.id}`" :alt="previewFileData.filename" style="max-width: 100%; max-height: 500px;">
                    </div>
                    <div v-else-if="isVideoFile(previewFileData.filename)" class="video-preview">
                        <video controls style="max-width: 100%; max-height: 500px;">
                            <source :src="`/api/download?id=${previewFileData.id}`" :type="previewFileData.mime_type">
                            æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘é¢„è§ˆ
                        </video>
                    </div>
                    <div v-else-if="isTextFile(previewFileData.filename)" class="text-preview">
                        <pre>{{ previewContent }}</pre>
                    </div>
                    <div v-else class="unsupported-preview">
                        <div class="unsupported-icon">ğŸ“„</div>
                        <p>{{ previewContent || 'æ­¤æ–‡ä»¶ç±»å‹ä¸æ”¯æŒé¢„è§ˆ' }}</p>
                        <button @click="downloadFile(previewFileData)" class="download-btn">ğŸ’¾ ä¸‹è½½æŸ¥çœ‹</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ¶ˆæ¯æç¤º -->
        <div v-if="message" :class="['message', message.type]" @click="message = null">
            {{ message.text }}
        </div>
    </div>

    <script src="/js/app.js"></script>
</body>
</html> 
</html> 